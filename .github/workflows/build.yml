name: Build

on: [push, pull_request]

jobs:
    windows:
        runs-on: windows-latest
        steps:
        - uses: actions/checkout@main
          with:
            submodules: true
        - uses: denoland/setup-deno@v2
        - name: build debug
          run: |
            ./fibs config win-vstudio-debug
            ./fibs build
        - name: build release
          run: |
            ./fibs config win-vstudio-release
            ./fibs build
        - name: test
          run: |
            ./fibs runtests win-vstudio-release
    mac:
        runs-on: macos-latest
        steps:
        - uses: actions/checkout@main
          with:
            submodules: true
        - uses: ashutoshvarma/setup-ninja@master
        - uses: denoland/setup-deno@v2
        - name: build debug
          run: |
            ./fibs config macos-ninja-debug
            ./fibs build
        - name: build release
          run: |
            ./fibs config macos-ninja-release
            ./fibs build
        - name: test
          run: |
            ./fibs runtests macos-ninja-release
    linux:
        runs-on: ubuntu-latest
        steps:
        - uses: actions/checkout@main
          with:
            submodules: true
        - uses: ashutoshvarma/setup-ninja@master
        - uses: denoland/setup-deno@v2
        - name: build debug
          run: |
            ./fibs config linux-ninja-debug
            ./fibs build
        - name: build release
          run: |
            ./fibs config linux-ninja-release
            ./fibs build
        - name: test
          run: |
            ./fibs runtests linux-ninja-release
    linux-arm64:
        runs-on: ubuntu-24.04-arm
        steps:
        - uses: actions/checkout@main
          with:
            submodules: true
        - uses: ashutoshvarma/setup-ninja@master
        - uses: denoland/setup-deno@v2
        - name: build debug
          run: |
            ./fibs config linux-ninja-debug
            ./fibs build
        - name: build release
          run: |
            ./fibs config linux-ninja-release
            ./fibs build
        - name: test
          run: |
            ./fibs runtests linux-ninja-release
